<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://genshi.edgewall.org/i18n"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="layout.html" />
  <head>
    <title>${object.uuid}</title>
  </head>
  <body>
    <div id="content"><div id="crashdump"
         py:with="can_append = 'TICKET_APPEND' in perm(object.resource);
                  can_modify = 'TICKET_CHGPROP' in perm(object.resource);
                  can_edit = 'TICKET_EDIT_DESCRIPTION' in perm(object.resource);
                  only_for_admin = 'TICKET_ADMIN' in perm(object.resource);
                  has_edit_comment = 'TICKET_EDIT_COMMENT' in perm(object.resource);
                  has_property_editor = not version and version != 0 and not cnum_edit
                                        and (can_append or can_modify or can_edit or can_create)">

      <div class="trac-topnav" py:if="has_property_editor">
        <a href="#modify" title="Go to the ticket editor">Modify</a> &darr;
      </div>

  <div class="date">
    <p i18n:msg="crashed">Crashed ${pretty_dateinfo(object.crashtime)}</p>
    <p i18n:msg="created">Uploaded ${pretty_dateinfo(object.uploadtime)}</p>
    <p i18n:msg="closed" py:if="object.closetime">Closed ${pretty_dateinfo(object.closetime)}</p>
    <p i18n:msg="modified" py:if="object.changetime != object.uploadtime and object.changetime != object.closetime">
      Last modified ${pretty_dateinfo(object.changetime)}</p>
  </div>
  <!--! use a placeholder if it's a new ticket -->

  <h2>
    <a href="${href('crash', object.uuid)}" class="trac-id">{${object.uuid}}</a>
    <span class="trac-status">
      ${'status' in fields_map and fields[fields_map['status']].rendered or object.status}
    </span>
    <span class="trac-type" py:if="object.type">
      ${'type' in fields_map and fields[fields_map['type']].rendered or object.type}
    </span>
    <span class="trac-resolution" py:if="object.resolution">
      (${'resolution' in fields_map and fields[fields_map['resolution']].rendered or object.resolution})
    </span>
  </h2>


<table class="properties">
<h2></h2>
<tr>
<th>Reported by:</th><td>${object.reported}</td>
<th>Owned by:</th><td>${object.owner}</td>
</tr>
<tr>
<th>Priority:</th><td>${object.priority}</td>
<th>Severity:</th><td>${object.severity}</td>
</tr>
<tr>
<th>Version:</th><td>${object.version}</td>
<th>Milestone:</th><td>${object.milestone}</td>
</tr>
<tr>
<th>Application name:</th><td>${object.applicationname}</td>
<th>Component:</th><td>${object.component}</td>
</tr>
<tr>
<th>Keywords:</th><td>${object.keywords}</td>
<th>Cc:</th><td>${object.cc}</td>
</tr>
</table>
<h3 id="crash_dump_info">Crash dump information</h3>
<table class="properties">
<tr><th>Application&nbsp;file</th>
<td class="fullrow">${object.applicationfile}</td>
</tr>
<tr><td>Command&nbsp;line</td><td class="fullrow"><pre class="cmdline"><py:for each="e in crash_info.command_line">&quot;${e}&quot;</py:for></pre></td></tr>
<tr><td>Report&nbsp;FQDN</td><td class="fullrow">${crash_info.report_fqdn}</td></tr>
<tr><td>Report&nbsp;username</td><td class="fullrow">${crash_info.report_username}</td></tr>
<tr><td>Symbol&nbsp;directories</td><td class="fullrow"><ul class="dirlist"><py:for each="e in crash_info.symbol_directories"><li>${e}</li></py:for></ul></td></tr>
<tr><td>Image&nbsp;directories</td><td class="fullrow"><ul class="dirlist"><py:for each="e in crash_info.image_directories"><li>${e}</li></py:for></ul></td></tr>
<tr><td>Environment</td><td class="fullrow">
<ul class="environment">
<py:for each="k in sorted(crash_info.environment.keys())">
<li>${k}&nbsp;=&nbsp;${crash_info.environment[k]}</li>
</py:for>
</ul>
</td></tr>
</table>

<h2>System information</h2>
<table class="properties">
<tr><td>Platform&nbsp;type</td><td class="fullrow">${system_info.platform_type}</td>
</tr>
<tr><td>CPU&nbsp;type</td><td class="fullrow">${system_info.cpu_type}&nbsp;<a href="http://en.wikipedia.org/wiki/CPUID">CPUID information</a></td></tr>
<tr><td>Number&nbsp;of&nbsp;CPUs</td><td class="fullrow">${system_info.number_of_cpus}</td></tr>
<tr><td>CPU&nbsp;64-bit</td><td class="fullrow">${system_info.cpu_64_bit}</td></tr>
<tr><td>CPU&nbsp;vendor</td><td class="fullrow">${system_info.cpu_vendor}</td></tr>
<tr><td>CPU&nbsp;name</td><td class="fullrow">${system_info.cpu_name}</td></tr>
<tr><td>CPU&nbsp;level</td><td class="fullrow">${ hex_format(system_info.cpu_level) }&nbsp;<a href="http://en.wikipedia.org/wiki/Stepping_level">More info</a></td></tr>
<tr><td>CPU&nbsp;revision</td><td class="fullrow">${ hex_format(system_info.cpu_revision) }</td></tr>
<tr><td>OS&nbsp;version</td><td class="fullrow">${system_info.os_version}</td></tr>
<tr><td>OS&nbsp;version&nbsp;info</td><td class="fullrow">${system_info.os_version_info}</td></tr>
<tr><td>Distribution&nbsp;id</td><td class="fullrow">${system_info.distribution_id}</td></tr>
<tr><td>Distribution&nbsp;release</td><td class="fullrow">${system_info.distribution_release}</td></tr>
<tr><td>Distribution&nbsp;codename</td><td class="fullrow">${system_info.distribution_codename}</td></tr>
<tr><td>Distribution&nbsp;description</td><td class="fullrow">${system_info.distribution_description}</td></tr>
</table>

<py:if test="fast_protect_version_info">
<h2>Version info</h2>
<table class="properties">
<tr><td>Product name</td><td class="fullrow">${fast_protect_version_info.product_name}</td></tr>
<tr><td>Product code name</td><td class="fullrow">${fast_protect_version_info.product_code_name}</td></tr>
<tr><td>Product version</td><td class="fullrow">${fast_protect_version_info.product_version}</td></tr>
<tr><td>Product target version</td><td class="fullrow">${fast_protect_version_info.product_target_version}</td></tr>
<tr><td>Root repository revision</td><td class="fullrow">${fast_protect_version_info.root_revision}</td></tr>
<tr><td>Build tools repository revision</td><td class="fullrow">${fast_protect_version_info.buildtools_revision}</td></tr>
<tr><td>External repository revision</td><td class="fullrow">${fast_protect_version_info.external_revision}</td></tr>
<tr><td>Third-party repository revision</td><td class="fullrow">${fast_protect_version_info.third_party_revision}</td></tr>
<tr><td>${fast_protect_version_info.product_name} repository revision</td><td class="fullrow">${fast_protect_version_info.terra3d_revision}</td></tr>
<tr><td>Jenkins job name</td><td class="fullrow">${fast_protect_version_info.jenkins_job_name}</td></tr>
<tr><td>Jenkins build number</td><td class="fullrow">${fast_protect_version_info.jenkins_build_number}</td></tr>
<tr><td>Jenkins build id</td><td class="fullrow">${fast_protect_version_info.jenkins_build_id}</td></tr>
<tr><td>Jenkins build tag</td><td class="fullrow">${fast_protect_version_info.jenkins_build_tag}</td></tr>
<tr><td>Jenkins build url</td><td class="fullrow"><a href="${fast_protect_version_info.jenkins_build_url}">${fast_protect_version_info.jenkins_build_url}</a></td></tr>
<tr><td>Jenkins Git revision</td><td class="fullrow">${fast_protect_version_info.jenkins_git_revision}</td></tr>
<tr><td>Jenkins Git branch</td><td class="fullrow">${fast_protect_version_info.jenkins_git_branch}</td></tr>
<tr><td>Jenkins master</td><td class="fullrow">${fast_protect_version_info.jenkins_master}</td></tr>
<tr><td>Jenkins nodename</td><td class="fullrow">${fast_protect_version_info.jenkins_nodename}</td></tr>
</table>
</py:if>

<py:if test="fast_protect_gfxcaps">
<h2>Version info</h2>
<table class="properties">
<tr><td>OpenGL vendor</td><td class="fullrow">${fast_protect_gfxcaps.opengl_vendor}</td></tr>
<tr><td>OpenGL renderer</td><td class="fullrow">${fast_protect_gfxcaps.opengl_renderer}</td></tr>
<tr><td>OpenGL version</td><td class="fullrow">${fast_protect_gfxcaps.opengl_version}</td></tr>
<tr><td>OpenGL vendor id</td><td class="fullrow">${fast_protect_gfxcaps.opengl_vendor_id}</td></tr>
<tr><td>OpenGL driver id</td><td class="fullrow">${fast_protect_gfxcaps.opengl_driver_id}</td></tr>
<tr><td>OpenGL chip class</td><td class="fullrow">${fast_protect_gfxcaps.opengl_chip_class}</td></tr>
<tr><td>OpenGL driver version</td><td class="fullrow">${fast_protect_gfxcaps.opengl_driver_version}</td></tr>
<tr><td>OpenGL hardware ok</td><td class="fullrow">${fast_protect_gfxcaps.opengl_hardware_ok}</td></tr>
<tr><td>OpenGL use pbuffer</td><td class="fullrow">${fast_protect_gfxcaps.opengl_use_pbuffer}</td></tr>
<tr><td>OpenGL hardware error</td><td class="fullrow">${fast_protect_gfxcaps.opengl_hardware_error}</td></tr>
<tr><td>OpenGL pbuffer error</td><td class="fullrow">${fast_protect_gfxcaps.opengl_pbuffer_error}</td></tr>
</table>
</py:if>

<py:if test="exception">
<h2>Exception</h2>
<table class="properties">
<tr><td>Thread id</td>
    <td class="fullrow">
        <a href="#thread_${exception.thread}">${ hex_format(exception.thread) }</a>
    </td>
</tr>
<tr><td>Code</td><td class="fullrow">${hex_format(exception.code)}</td></tr>
<tr><td>Name</td><td class="fullrow">${exception.name}</td></tr>
<tr><td>Info</td><td class="fullrow">${exception.info}</td></tr>
<tr><td>Address</td><td class="fullrow">${ hex_format(exception.address) }</td></tr>
<tr><td>Flags</td><td class="fullrow">${ hex_format(exception.flags) }</td></tr>
</table>
</py:if>

<py:if test="assertion">
<h2>Assertion</h2>
<table class="properties">
<tr><td>Expression</td><td class="fullrow">${assertion.expression}</td></tr>
<tr><td>Function</td><td class="fullrow">${assertion.function}</td></tr>
<tr><td>Source</td><td class="fullrow">${assertion.source}</td></tr>
<tr><td>Line</td><td class="fullrow">${assertion.line}</td></tr>
</table>
</py:if>

<h2>Modules</h2>
<table class="properties">
<tr>
<th>Base</th>
<th>Size</th>
<th>Timestamp</th>
<th>Product version</th>
<th>File version</th>
<th>Flags</th>
<th>Name</th>
<th>Symbol&nbsp;file</th>
</tr>
<py:for each="module in modules">
<tr>
<td>${ hex_format(module.base)}</td>
<td>${module.size} </td>
<td>${module.timestamp}</td>
<td>${module.product_version} </td>
<td>${module.file_version}</td>
<td>${module.flags}</td>
<td>${module.name}</td>
<td>${module.symbol_file} </td>
</tr>
</py:for>
</table>

<h2>Threads</h2>
<table class="properties">
<tr>
<th>Id</th>
<th>Name</th>
<th>Memory</th>
<th>Start address</th>
<th>Create time</th>
<th>Exit time</th>
<th>Kernel time</th>
<th>User time</th>
</tr>
<py:for each="thread in threads">
<tr>
<td><a name="thread_${thread.id}">${ hex_format(thread.id)}<py:if test="thread.exception">*</py:if></a></td>
<td>${thread.name} </td>
<td><a href="#memory_block_${thread.memory}">${ hex_format(thread.memory) }</a></td>
<td>${ hex_format(thread.start_addr) }</td>
<td>${thread.create_time}</td>
<td>${thread.exit_time}</td>
<td>${thread.kernel_time} </td>
<td>${thread.user_time}</td>
</tr>
</py:for>
</table>

<h2>Stack dumps</h2>
<py:for each="stackdump in stackdumps">
<h3><a href="#thread_${stackdump.threadid}">Thread ${ hex_format(stackdump.threadid) }</a><py:if test="stackdump.exception"> with exception</py:if></h3>
<table class="properties">
<tr>
<th>Num</th>
<th>Addr</th>
<th>RetAddr</th>
<th>Param0</th>
<th>Param1</th>
<th>Param2</th>
<th>Param3</th>
<th>Module</th>
<th>Function</th>
<th>Source</th>
<th>LineOff</th>
</tr>
<py:for each="frame in stackdump.callstack">
<tr>
<td>${frame.num}</td>
<td>${ hex_format(frame.addr) }</td>
<td>${ hex_format(frame.retaddr) }</td>
<td>${ hex_format(frame.param0) }</td>
<td>${ hex_format(frame.param1) }</td>
<td>${ hex_format(frame.param2) }</td>
<td>${ hex_format(frame.param3) }</td>
<td>${frame.module}</td>
<td>${frame.function}</td>
<td>
<py:choose test="frame.source and len(frame.source)">
  <py:when test="False">Unknown</py:when>
  <py:otherwise><a href="${frame.source_url}">${frame.source}:${frame.line}</a></py:otherwise>
</py:choose>
</td>
<td>${ hex_format(frame.lineoff) }</td>
</tr>
</py:for>
</table>
</py:for>

<h2>Memory regions</h2>
<table class="properties">
<tr>
<th>Base address</th>
<th>Size</th>
<th>Alloc base</th>
<th>Alloc protect</th>
<th>Type</th>
<th>Protect</th>
<th>State</th>
</tr>
<py:for each="memory_region in memory_regions">
<tr>
<td>${ hex_format(memory_region.base_addr) }</td>
<td>${memory_region.size} </td>
<td>${ hex_format(memory_region.alloc_base) }</td>
<td>${ hex_format(memory_region.alloc_prot) }</td>
<td>${ hex_format(memory_region.type) }</td>
<td>${ hex_format(memory_region.protect) }</td>
<td>${ hex_format(memory_region.state) }</td>
</tr>
</py:for>
</table>

<h2>Memory blocks</h2>
<table class="memory_blocks">
<py:for each="memory_block in memory_blocks">
<h3><a name="memory_block_${memory_block.base}">Memory block #${memory_block.num} at ${ hex_format(memory_block.base) } size ${memory_block.size} bytes</a></h3>
<table class="memory_block">
<py:for each="hexdump_line in memory_block.memory.hexdump">
<tr>
<td>${hex_format(hexdump_line.offset, width=memory_block.memory.hexdump.offset_width) }</td>
<td><pre class="hexdump_hex">${hexdump_line.hex}</pre></td>
<td><pre class="hexdump_ascii">${hexdump_line.ascii}</pre></td>
</tr>
</py:for>
</table>
</py:for>
</table>

</div>

        <div style="${'display: none' if not changes else None}">
          <div style="position: relative">
            <form id="prefs" method="get" action="${href.prefs()}" style="position: absolute; right: 0">
              <div id="trac-comments-order">
                <input type="radio" id="trac-comments-oldest" name="trac-comments-order" value="oldest" checked="checked" />
                <label for="trac-comments-oldest">Oldest first</label>
                <input type="radio" id="trac-comments-newest" name="trac-comments-order" value="newest" />
                <label for="trac-comments-newest">Newest first</label>
                <span id="trac-threaded-toggle" style="display: none">
                  <input type="radio" id="trac-comments-threaded" name="trac-comments-order" value="threaded" />
                  <label for="trac-comments-threaded">Threaded</label>
                </span>
              </div>
              <div>
                <input id="trac-comments-only-toggle" type="checkbox" />
                <label for="trac-comments-only-toggle">Comments only</label>
              </div>
            </form>
          </div>

          <h3 class="foldable">Change History <span class="trac-count">(${len(changes)})</span></h3>

          <div id="changelog">
            <py:for each="change in changes">
              <div class="change${' trac-new' if change.date > start_time and 'attachment' not in change.fields else None}"
                   id="${'trac-change-%d-%d' % (change.cnum, to_utimestamp(change.date)) if 'cnum' in change else None}">
                <xi:include href="ticket_change.html"/>
              </div>
            </py:for>
          </div>
        </div>

      <form method="post" id="propertyform" action="${href('crash', object.id) + '#trac-add-comment'}">
        <!--! Add comment -->
        <div id="trac-add-comment" class="field">
          <h3 class="foldable" id="edit">Add Comment</h3>
          <div>
            <div id="trac-edit-warning" class="warning system-message"
                 style="${'display: none' if start_time == object.changetime else None}"
                 i18n:msg="">
              This crash dump has been modified since you started editing. You should review the
              <em class="trac-new">other modifications</em> which have been appended above,
              and any <em class="trac-conflict">conflicts</em> shown in the preview below.
              You can nevertheless proceed and submit your changes if you wish so.
            </div>
            <!--! Comment field -->
            <fieldset>
              <label for="comment" i18n:msg="">You may use
                <a tabindex="42" href="${href.wiki('WikiFormatting')}">WikiFormatting</a>
                here.
              </label>
              <textarea id="comment" name="comment" class="wikitext trac-resizable" rows="10" cols="78">
${comment}</textarea>
            </fieldset>
          </div>
        </div>

        <div>
          <h3 class="foldable">Modify Crash information</h3>
          <div id="modify">
            <!--! Properties -->
            <fieldset id="properties"
                      py:with="fields = [f for f in fields if not f.skip]">
              <legend py:choose="">
                  Change Properties
              </legend>
              <table>
                <tr>
                  <th><label for="field-summary">Summary:</label></th>
                  <td class="fullrow" colspan="3">
                    <input type="text" id="field-summary" name="field_summary"
                           value="$object.summary" size="70" />
                  </td>
                </tr>
                <py:if test="False">
                  <tr>
                    <th><label for="field-reporter">Reporter:</label></th>
                    <td class="fullrow" colspan="3">
                      <input type="text" id="field-reporter" name="field_reporter"
                             value="${object.reporter}" size="70" />
                    </td>
                  </tr>
                </py:if>
                <py:if test="True">
                  <tr>
                    <th><label for="field-description">Description:</label></th>
                    <td class="fullrow" colspan="3">
                      <fieldset>
                        <label for="field-description" id="field-description-help" i18n:msg="">You may use
                          <a tabindex="42" href="${href.wiki('WikiFormatting')}">WikiFormatting</a> here.
                        </label>
                        <textarea id="field-description" name="field_description"
                                  class="wikitext trac-resizable" rows="10" cols="68">
${object.description}</textarea>
                      </fieldset>
                    </td>
                  </tr>
                </py:if>
                <tr py:for="row in group(fields, 2, lambda f: f.type != 'textarea')"
                    py:if="can_modify or can_create"
                    py:with="fullrow = len(row) == 1">
                  <py:for each="idx, field in enumerate(row)"
                          py:with="value = ticket.get_value_or_default(field.name)">
                    <th class="col${idx + 1}" py:if="idx == 0 or not fullrow">
                      <label for="field-${field.name}" py:if="field"
                             py:strip="field.type == 'radio'" i18n:msg="field">${
                        field.edit_label or field.label or field.name}:</label>
                    </th>
                    <td class="col${idx + 1}" py:if="idx == 0 or not fullrow"
                        colspan="${3 if fullrow else None}">
                      <py:choose test="field.type" py:if="field">
                        <select py:when="'select'" id="field-${field.name}" name="field_${field.name}">
                          <option py:if="field.optional"></option>
                          <option py:for="option in field.options"
                                  selected="${value == option or None}"
                                  value="$option" py:content="option"></option>
                          <optgroup py:for="optgroup in field.optgroups"
                                    py:if="optgroup.options"
                                    label="${optgroup.label}">
                            <option py:for="option in optgroup.options"
                                    selected="${value == option or None}"
                                    value="$option" py:content="option"></option>
                          </optgroup>
                        </select>
                        <textarea py:when="'textarea'" id="field-${field.name}" name="field_${field.name}"
                                  cols="${field.width}" rows="${field.height}"
                                  class="${'wikitext ' if field.format == 'wiki' else None}trac-resizable">
${value}</textarea>
                        <span py:when="'checkbox'">
                          <input type="checkbox" id="field-${field.name}" name="field_${field.name}"
                                 checked="${value == '1' or None}" value="1" />
                          <input type="hidden" name="field_checkbox_${field.name}" value="1" />
                        </span>
                        <label py:when="'radio'"
                               py:for="idx, option in enumerate(field.options)">
                          <input type="radio" name="field_${field.name}" value="${option}"
                                 checked="${value == option or None}" />
                          ${option}
                        </label>
                        <py:otherwise><!--! Text input fields -->
                          <py:choose>
                            <span py:when="field.cc_entry"><!--! Special case for Cc: field -->
                              <em>${field.cc_entry}</em>
                              <input type="checkbox" id="field-cc" name="cc_update"
                                title="This checkbox allows you to add or remove yourself from the CC list."
                                checked="${field.cc_update}" />
                            </span>
                            <!--! Cc: when TICKET_EDIT_CC is allowed -->
                            <span py:when="field.name == 'cc'">
                              <input  type="text" id="field-${field.name}"
                                title="Space or comma delimited email addresses and usernames are accepted."
                                name="field_${field.name}" value="${value}" />
                            </span>
                            <!--! All the other text input fields -->
                            <input py:otherwise="" type="text" id="field-${field.name}"
                              name="field_${field.name}" value="${value}" />
                          </py:choose>
                        </py:otherwise>
                      </py:choose>
                    </td>
                  </py:for>
                </tr>
              </table>
            </fieldset>

            <!--! Workflow support -->
                <fieldset id="action">
                  <legend>Action</legend>
                  <div py:for="key, label, controls, hints in action_controls">
                      <input type="radio" id="action_$key" name="action" value="$key"
                             checked="${key == action or None}" />
                      <label for="action_$key">$label</label>
                      $controls
                      <span class="hint" py:for="hint in hints">$hint</span>
                  </div>
                </fieldset>
                <py:for each="key, label, controls, hints in action_controls">
                    <input py:if="key == action" type="hidden" name="action" value="$action" />
                </py:for>
          </div>
        </div>

        <!--! Preview of ticket changes -->
        <!--
        <div py:if="ticket.exists and can_append" id="ticketchange" class="ticketdraft"
             style="${'display: none' if not (change_preview.fields or change_preview.comment)
                                         or cnum_edit is not None else None}">
          <xi:include href="ticket_change.html" py:with="change = change_preview; preview = True"/>
        </div>
        -->

        <div class="trac-nav">
          <a href="#attachments" id="trac-up-attachments" title="Go to the list of attachments">Attachments</a> &uarr;
          <a href="#comments" id="trac-up-comments" title="Go to the comments">Comments</a> &uarr;
          <a href="#content" id="trac-up-view" title="Go to the top">Top</a> &uarr;
        </div>
        <div class="buttons">
            <input type="hidden" name="start_time" value="${to_utimestamp(start_time)}" />
            <input type="hidden" name="view_time" value="${to_utimestamp(object.changetime)}" />
            <input type="hidden" name="replyto" value="${replyto}" />
          <input type="submit" name="preview" value="${_('Preview')}" accesskey="r" />&nbsp;
          <input type="submit" name="submit" value="${_('Submit changes')}" />
        </div>

      </form>

    </div>
  </body>
</html>
